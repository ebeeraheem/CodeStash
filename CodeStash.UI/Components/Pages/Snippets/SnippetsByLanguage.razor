@page "/snippets/languages/{language}"
@inject ISnippetService SnippetService
@inject LanguageStateService LanguageStateService

<MudProgressCircular Indeterminate="true" Color="Color.Primary"
                     Style="@($"margin:auto; display: block;{(_isLoading ? "display:block;" : "display:none")}")"
                     Size="Size.Medium" StrokeWidth="4" />

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <MudAlert Severity="Severity.Error">
        @ErrorMessage
    </MudAlert>

    <MudButton Variant="Variant.Outlined" Color="Color.Primary">
        Go Back to Home
    </MudButton>
}
else
{
    <MudText Typo="Typo.h2" Class="mt-8">
        <MudIcon Icon="@Icons.Material.Filled.Book" Title="@SelectedLanguage" />
        @SelectedLanguage
    </MudText>
    <MudGrid>
        @foreach (var snippetDto in SnippetDtos)
        {
            <SnippetGridItem SnippetDto="snippetDto" />
        }
    </MudGrid>
}

@code {
    [Parameter]
    public string? Language { get; set; }
    public string? SelectedLanguage { get; set; }
    public List<SnippetDto> SnippetDtos { get; set; } = [];
    private string? ErrorMessage { get; set; }
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        SelectedLanguage = LanguageStateService.SelectedLanguage;

        if (!string.IsNullOrEmpty(SelectedLanguage))
        {
            var result = await SnippetService.GetSnippetsByLanguage(SelectedLanguage);

            _isLoading = false;

            if (result.IsSuccess)
            {
                SnippetDtos = result.Data;
            }
            else
            {
                ErrorMessage = result.Error.ToString();
            }
        }
        else
        {
            _isLoading = false;
            ErrorMessage = "An unexpected error occurred. Please try again.";
        }
    }
}
